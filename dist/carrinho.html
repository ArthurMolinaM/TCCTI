<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrinho</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white shadow-md sticky top-0 z-20">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-xl font-semibold">Meu Carrinho</h1>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <table class="w-full bg-white rounded-lg shadow-sm overflow-hidden">
      <thead class="border-b bg-gray-100 text-gray-700 text-sm">
        <tr>
          <th class="text-left py-3 px-4 w-1/3">Produtos</th>
          <th class="text-center py-3 px-4">Preço Unitário</th>
          <th class="text-center py-3 px-4">Quantidade</th>
          <th class="text-center py-3 px-4">Preço Total</th>
          <th class="text-center py-3 px-4">Ações</th>
        </tr>
      </thead>
      <tbody id="cart-table" class="text-sm">
        <!-- Produtos serão inseridos via JS -->
      </tbody>
    </table>

    <div class="flex justify-end mt-6">
      <div class="bg-white p-4 rounded-lg shadow-sm w-full md:w-1/3">
        <div class="flex justify-between mb-3 text-gray-700">
          <span>Subtotal</span>
          <span id="subtotal">R$ 0,00</span>
        </div>
        <button id="checkout" class="w-full py-3 rounded-md bg-orange-500 text-white font-semibold hover:bg-orange-600">Finalizar Compra</button>
      </div>
    </div>
  </main>

  <script>
    const PRODUCTS = [
      {
        id: 'p1',
        name: 'Tênis Masculino Casual Unissex Lançamento Confortável 34-43',
        variation: 'Panda, 35',
        price: 49.90,
        oldPrice: 70.00,
        img: 'https://via.placeholder.com/80'
      }
    ];

    let cart = JSON.parse(localStorage.getItem('cart_v2') || '[]');

    const fmt = v => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    function renderCart() {
      const table = document.getElementById('cart-table');
      table.innerHTML = '';

      if (cart.length === 0) {
        table.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Seu carrinho está vazio.</td></tr>';
        document.getElementById('subtotal').textContent = fmt(0);
        return;
      }

      let subtotal = 0;
      cart.forEach(item => {
        const total = item.price * item.qty;
        subtotal += total;

        const tr = document.createElement('tr');
        tr.className = 'border-b hover:bg-gray-50';
        tr.innerHTML = `
          <td class="py-4 px-4">
            <div class="flex items-center gap-3">
              <input type="checkbox" class="mr-2">
              <img src="${item.img}" alt="${item.name}" class="w-20 h-20 object-cover rounded">
              <div>
                <p class="font-semibold text-gray-800">${item.name}</p>
                <p class="text-sm text-gray-500">Variações: ${item.variation}</p>
                <p class="text-xs text-green-600 font-medium mt-1">FRETE GRÁTIS acima de R$10</p>
              </div>
            </div>
          </td>
          <td class="text-center text-gray-700">
            <span class="line-through text-gray-400 mr-1">${fmt(item.oldPrice)}</span>
            <span class="font-semibold">${fmt(item.price)}</span>
          </td>
          <td class="text-center">
            <div class="flex justify-center items-center gap-2">
              <button data-id="${item.id}" class="decrease px-2 py-1 bg-gray-100 rounded">-</button>
              <input data-id="${item.id}" type="number" min="1" value="${item.qty}" class="w-14 text-center border rounded py-1">
              <button data-id="${item.id}" class="increase px-2 py-1 bg-gray-100 rounded">+</button>
            </div>
          </td>
          <td class="text-center font-semibold text-gray-800">${fmt(total)}</td>
          <td class="text-center">
            <button data-id="${item.id}" class="remove text-red-600 hover:underline text-sm">Excluir</button>
          </td>
        `;
        table.appendChild(tr);
      });

      document.getElementById('subtotal').textContent = fmt(subtotal);

      // Eventos
      document.querySelectorAll('.decrease').forEach(btn => {
        btn.onclick = () => updateQty(btn.dataset.id, -1);
      });
      document.querySelectorAll('.increase').forEach(btn => {
        btn.onclick = () => updateQty(btn.dataset.id, 1);
      });
      document.querySelectorAll('.remove').forEach(btn => {
        btn.onclick = () => removeItem(btn.dataset.id);
      });
      document.querySelectorAll('input[type=number]').forEach(inp => {
        inp.onchange = e => setQty(inp.dataset.id, parseInt(e.target.value));
      });
    }

    function updateQty(id, change) {
      const item = cart.find(i => i.id === id);
      if (!item) return;
      item.qty = Math.max(1, item.qty + change);
      save();
    }

    function setQty(id, val) {
      const item = cart.find(i => i.id === id);
      if (!item) return;
      item.qty = Math.max(1, val);
      save();
    }

    function removeItem(id) {
      cart = cart.filter(i => i.id !== id);
      save();
    }

    function save() {
      localStorage.setItem('cart_v2', JSON.stringify(cart));
      renderCart();
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (cart.length === 0) {
        cart = PRODUCTS.map(p => ({ ...p, qty: 1 }));
        save();
      } else renderCart();

      document.getElementById('checkout').onclick = () => {
        const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
        alert(`Compra finalizada! Total: ${fmt(subtotal)}`);
        cart = [];
        save();
      };
    });
  </script>
</body>
</html>